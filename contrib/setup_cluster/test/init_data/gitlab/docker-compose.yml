version: '2'
services:
 gitlab:
    build: ../Gitlab
    image: gitlab_server
    container_name: gitlab_server_for_existed_test
    hostname: gitlab
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url 'https://127.0.0.1/gitlab'
        letsencrypt['enable'] = false
        nginx['ssl_certificate'] = "/mnt/gitlab/ssl/certificate_local.crt"
        nginx['ssl_certificate_key'] = "/mnt/gitlab/ssl/certificate_local.key"
        gitlab_rails['gitlab_https'] = true
        gitlab_rails['gitlab_port'] = 443
        prometheus_monitoring['enable'] = false
    restart: always
    privileged: true
    ports:
     - 443:443
    expose: 
      - "3023"
    networks:
      static-network:
        ipv4_address: 172.29.0.27
networks:
  static-network:
    ipam:
      config:
        - subnet: 172.29.0.0/24
          gateway: 172.29.0.1
