\set ECHO none
SET timezone TO 0;
SET datestyle TO ISO;
SET intervalstyle to "postgres";
--Testcase 1:
CREATE EXTENSION IF NOT EXISTS pgspider_core_fdw;
--Testcase 2:
CREATE SERVER pgspider_core_srv FOREIGN DATA WRAPPER pgspider_core_fdw OPTIONS (host '127.0.0.1', port '50849');
--Testcase 3:
CREATE USER mapping for public server pgspider_core_srv;
--Testcase 4:
CREATE EXTENSION gitlab_fdw;
--Testcase 5:
CREATE SERVER gitlab_svr1 FOREIGN DATA WRAPPER gitlab_fdw OPTIONS (endpoint :END_POINT_1, ssl_verifypeer 'false');
--Testcase 6:
CREATE USER MAPPING FOR public SERVER gitlab_svr1 OPTIONS (access_token :ACCESS_TOKEN_1);
--Testcase 7:
CREATE SERVER gitlab_svr2 FOREIGN DATA WRAPPER gitlab_fdw OPTIONS (endpoint :END_POINT_2, ssl_verifypeer 'false');
--Testcase 8:
CREATE USER MAPPING FOR public SERVER gitlab_svr2 OPTIONS (access_token :ACCESS_TOKEN_2);
--Testcase 9:
CREATE MULTI TENANT TABLE projects (id bigint, description text, name text, name_with_namespace text, "path" text, path_with_namespace text, created_at timestamp with time zone, default_branch text, ssh_url_to_repo text, http_url_to_repo text, web_url text, readme_url text, avatar_url text, forks_count bigint, star_count bigint, last_activity_at timestamp with time zone, __spd_url text) MULTI TENANT pgspider_core_srv;
--Testcase 10:
CREATE FOREIGN TABLE projects__gitlab_svr1__0 (id bigint, description text, name text, name_with_namespace text, "path" text, path_with_namespace text, created_at timestamp with time zone, default_branch text, ssh_url_to_repo text, http_url_to_repo text, web_url text, readme_url text, avatar_url text, forks_count bigint, star_count bigint, last_activity_at timestamp with time zone) SERVER gitlab_svr1 OPTIONS (resource_name 'projects');
--Testcase 11:
CREATE FOREIGN TABLE projects__gitlab_svr2__0 (id bigint, description text, name text, name_with_namespace text, "path" text, path_with_namespace text, created_at timestamp with time zone, default_branch text, ssh_url_to_repo text, http_url_to_repo text, web_url text, readme_url text, avatar_url text, forks_count bigint, star_count bigint, last_activity_at timestamp with time zone) SERVER gitlab_svr2 OPTIONS (resource_name 'projects');
-- SELECT column
--Testcase 12:
EXPLAIN VERBOSE SELECT id FROM projects ORDER BY id;
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Sort  (cost=859.49..876.55 rows=6826 width=8)
   Output: id
   Sort Key: projects.id
   ->  Foreign Scan on public.projects  (cost=200.00..424.78 rows=6826 width=8)
         Output: id
         Node: gitlab_svr1 / Status: Alive
           Sort push-down: no
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
         Node: gitlab_svr2 / Status: Alive
           Sort push-down: no
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(11 rows)

--Testcase 13:
SELECT id FROM projects ORDER BY id;
 id 
----
  2
  2
  3
  3
  4
  4
  5
  5
  6
  6
  7
  7
  8
  8
  9
  9
 10
 10
 11
 11
 12
 12
 13
 13
(24 rows)

-- Select  columns of each resource with WHERE filter: single condition of column (=, <=, >=, like...), multi condition with AND, OR
--Testcase 14:
EXPLAIN VERBOSE SELECT description, name, name_with_namespace, default_branch, ssh_url_to_repo FROM projects WHERE description IS NOT NULL AND default_branch = 'master' ORDER BY 1, 2, 3, 4, 5;
                                               QUERY PLAN                                                
---------------------------------------------------------------------------------------------------------
 Sort  (cost=442.71..442.79 rows=34 width=160)
   Output: description, name, name_with_namespace, default_branch, ssh_url_to_repo
   Sort Key: projects.description, projects.name, projects.name_with_namespace, projects.ssh_url_to_repo
   ->  Foreign Scan on public.projects  (cost=200.00..441.84 rows=34 width=160)
         Output: description, name, name_with_namespace, default_branch, ssh_url_to_repo
         Filter: ((projects.description IS NOT NULL) AND (projects.default_branch = 'master'::text))
         Node: gitlab_svr1 / Status: Alive
           Sort push-down: no
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
         Node: gitlab_svr2 / Status: Alive
           Sort push-down: no
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(12 rows)

--Testcase 15:
SELECT description, name, name_with_namespace, default_branch, ssh_url_to_repo FROM projects WHERE description IS NOT NULL AND default_branch = 'master' ORDER BY 1, 2, 3, 4, 5;
        description        |         name          |         name_with_namespace         | default_branch |                ssh_url_to_repo                 
---------------------------+-----------------------+-------------------------------------+----------------+------------------------------------------------
 Test gitlab_fdw project 1 | test_project_gitlab_1 | Alan Nguyen / test_project_gitlab_1 | master         | git@127.0.0.1:user_1/test_project_gitlab_1.git
 Test gitlab_fdw project 1 | test_project_gitlab_1 | Alan Nguyen / test_project_gitlab_1 | master         | git@127.0.0.1:user_1/test_project_gitlab_1.git
 Test gitlab_fdw project 2 | test_project_gitlab_2 | Alan Nguyen / test_project_gitlab_2 | master         | git@127.0.0.1:user_1/test_project_gitlab_2.git
 Test gitlab_fdw project 2 | test_project_gitlab_2 | Alan Nguyen / test_project_gitlab_2 | master         | git@127.0.0.1:user_1/test_project_gitlab_2.git
 Test Project 1            | test_project_1        | Alan Nguyen / test_project_1        | master         | git@127.0.0.1:user_1/test_project_1.git
 Test Project 1            | test_project_1        | Alan Nguyen / test_project_1        | master         | git@127.0.0.1:user_1/test_project_1.git
 Test Project 1            | test_project_1        | db / test_project_1                 | master         | git@127.0.0.1:db/test_project_1.git
 Test Project 1            | test_project_1        | db / test_project_1                 | master         | git@127.0.0.1:db/test_project_1.git
 Test Project 2            | test_project_2        | db / test_project_2                 | master         | git@127.0.0.1:db/test_project_2.git
 Test Project 2            | test_project_2        | db / test_project_2                 | master         | git@127.0.0.1:db/test_project_2.git
 Test Project 3            | test_project_3        | db / test_project_3                 | master         | git@127.0.0.1:db/test_project_3.git
 Test Project 3            | test_project_3        | db / test_project_3                 | master         | git@127.0.0.1:db/test_project_3.git
 Test Project 4            | test_project_4        | db / test_project_4                 | master         | git@127.0.0.1:db/test_project_4.git
 Test Project 4            | test_project_4        | db / test_project_4                 | master         | git@127.0.0.1:db/test_project_4.git
 Test Project 5            | test_project_5        | db / test_project_5                 | master         | git@127.0.0.1:db/test_project_5.git
 Test Project 5            | test_project_5        | db / test_project_5                 | master         | git@127.0.0.1:db/test_project_5.git
 Test Project 6            | test_project_6        | db / test_project_6                 | master         | git@127.0.0.1:db/test_project_6.git
 Test Project 6            | test_project_6        | db / test_project_6                 | master         | git@127.0.0.1:db/test_project_6.git
 Test Project 7            | test_project_7        | db / test_project_7                 | master         | git@127.0.0.1:db/test_project_7.git
 Test Project 7            | test_project_7        | db / test_project_7                 | master         | git@127.0.0.1:db/test_project_7.git
(20 rows)

--Testcase 16:
EXPLAIN VERBOSE SELECT id, description, name, name_with_namespace, "path", path_with_namespace, created_at, default_branch, ssh_url_to_repo, http_url_to_repo, web_url, readme_url, avatar_url, forks_count, star_count, last_activity_at FROM projects ORDER BY id, description, name, name_with_namespace;
                                                                                                            QUERY PLAN                                                                                                            
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort  (cost=859.49..876.55 rows=6826 width=392)
   Output: id, description, name, name_with_namespace, path, path_with_namespace, created_at, default_branch, ssh_url_to_repo, http_url_to_repo, web_url, readme_url, avatar_url, forks_count, star_count, last_activity_at
   Sort Key: projects.id, projects.description, projects.name, projects.name_with_namespace
   ->  Foreign Scan on public.projects  (cost=200.00..424.78 rows=6826 width=392)
         Output: id, description, name, name_with_namespace, path, path_with_namespace, created_at, default_branch, ssh_url_to_repo, http_url_to_repo, web_url, readme_url, avatar_url, forks_count, star_count, last_activity_at
         Node: gitlab_svr1 / Status: Alive
           Sort push-down: no
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
         Node: gitlab_svr2 / Status: Alive
           Sort push-down: no
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(11 rows)

--Testcase 17:
SELECT id, description, name, name_with_namespace, "path", path_with_namespace, created_at, default_branch, ssh_url_to_repo, http_url_to_repo, web_url, readme_url, avatar_url, forks_count, star_count, last_activity_at FROM projects ORDER BY id, description, name, name_with_namespace;
 id |        description        |         name          |         name_with_namespace         |         path          |     path_with_namespace      |         created_at         | default_branch |                ssh_url_to_repo                 |                     http_url_to_repo                      |                        web_url                        |                                  readme_url                                   | avatar_url | forks_count | star_count |      last_activity_at      
----+---------------------------+-----------------------+-------------------------------------+-----------------------+------------------------------+----------------------------+----------------+------------------------------------------------+-----------------------------------------------------------+-------------------------------------------------------+-------------------------------------------------------------------------------+------------+-------------+------------+----------------------------
  2 | Test Project 1            | test_project_1        | db / test_project_1                 | test_project_1        | db/test_project_1            | 2023-07-19 02:55:54.527+00 | master         | git@127.0.0.1:db/test_project_1.git            | https://127.0.0.1/gitlab/db/test_project_1.git            | https://127.0.0.1/gitlab/db/test_project_1            | https://127.0.0.1/gitlab/db/test_project_1/-/blob/master/README.md            |            |           1 |          0 | 2023-07-19 02:55:54.527+00
  2 | Test Project 1            | test_project_1        | db / test_project_1                 | test_project_1        | db/test_project_1            | 2023-07-19 02:55:54.527+00 | master         | git@127.0.0.1:db/test_project_1.git            | https://127.0.0.1/gitlab/db/test_project_1.git            | https://127.0.0.1/gitlab/db/test_project_1            | https://127.0.0.1/gitlab/db/test_project_1/-/blob/master/README.md            |            |           1 |          0 | 2023-07-19 02:55:54.527+00
  3 | Test Project 2            | test_project_2        | db / test_project_2                 | test_project_2        | db/test_project_2            | 2023-07-19 02:56:04.34+00  | master         | git@127.0.0.1:db/test_project_2.git            | https://127.0.0.1/gitlab/db/test_project_2.git            | https://127.0.0.1/gitlab/db/test_project_2            | https://127.0.0.1/gitlab/db/test_project_2/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:04.34+00
  3 | Test Project 2            | test_project_2        | db / test_project_2                 | test_project_2        | db/test_project_2            | 2023-07-19 02:56:04.34+00  | master         | git@127.0.0.1:db/test_project_2.git            | https://127.0.0.1/gitlab/db/test_project_2.git            | https://127.0.0.1/gitlab/db/test_project_2            | https://127.0.0.1/gitlab/db/test_project_2/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:04.34+00
  4 | Test Project 3            | test_project_3        | db / test_project_3                 | test_project_3        | db/test_project_3            | 2023-07-19 02:56:07.775+00 | master         | git@127.0.0.1:db/test_project_3.git            | https://127.0.0.1/gitlab/db/test_project_3.git            | https://127.0.0.1/gitlab/db/test_project_3            | https://127.0.0.1/gitlab/db/test_project_3/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:07.775+00
  4 | Test Project 3            | test_project_3        | db / test_project_3                 | test_project_3        | db/test_project_3            | 2023-07-19 02:56:07.775+00 | master         | git@127.0.0.1:db/test_project_3.git            | https://127.0.0.1/gitlab/db/test_project_3.git            | https://127.0.0.1/gitlab/db/test_project_3            | https://127.0.0.1/gitlab/db/test_project_3/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:07.775+00
  5 | Test Project 4            | test_project_4        | db / test_project_4                 | test_project_4        | db/test_project_4            | 2023-07-19 02:56:11.626+00 | master         | git@127.0.0.1:db/test_project_4.git            | https://127.0.0.1/gitlab/db/test_project_4.git            | https://127.0.0.1/gitlab/db/test_project_4            | https://127.0.0.1/gitlab/db/test_project_4/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:11.626+00
  5 | Test Project 4            | test_project_4        | db / test_project_4                 | test_project_4        | db/test_project_4            | 2023-07-19 02:56:11.626+00 | master         | git@127.0.0.1:db/test_project_4.git            | https://127.0.0.1/gitlab/db/test_project_4.git            | https://127.0.0.1/gitlab/db/test_project_4            | https://127.0.0.1/gitlab/db/test_project_4/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:11.626+00
  6 | Test Project 5            | test_project_5        | db / test_project_5                 | test_project_5        | db/test_project_5            | 2023-07-19 02:56:19.285+00 | master         | git@127.0.0.1:db/test_project_5.git            | https://127.0.0.1/gitlab/db/test_project_5.git            | https://127.0.0.1/gitlab/db/test_project_5            | https://127.0.0.1/gitlab/db/test_project_5/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:19.285+00
  6 | Test Project 5            | test_project_5        | db / test_project_5                 | test_project_5        | db/test_project_5            | 2023-07-19 02:56:19.285+00 | master         | git@127.0.0.1:db/test_project_5.git            | https://127.0.0.1/gitlab/db/test_project_5.git            | https://127.0.0.1/gitlab/db/test_project_5            | https://127.0.0.1/gitlab/db/test_project_5/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:19.285+00
  7 | Test Project 6            | test_project_6        | db / test_project_6                 | test_project_6        | db/test_project_6            | 2023-07-19 02:56:22.376+00 | master         | git@127.0.0.1:db/test_project_6.git            | https://127.0.0.1/gitlab/db/test_project_6.git            | https://127.0.0.1/gitlab/db/test_project_6            | https://127.0.0.1/gitlab/db/test_project_6/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:22.376+00
  7 | Test Project 6            | test_project_6        | db / test_project_6                 | test_project_6        | db/test_project_6            | 2023-07-19 02:56:22.376+00 | master         | git@127.0.0.1:db/test_project_6.git            | https://127.0.0.1/gitlab/db/test_project_6.git            | https://127.0.0.1/gitlab/db/test_project_6            | https://127.0.0.1/gitlab/db/test_project_6/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:22.376+00
  8 | Test Project 7            | test_project_7        | db / test_project_7                 | test_project_7        | db/test_project_7            | 2023-07-19 02:56:25.15+00  | master         | git@127.0.0.1:db/test_project_7.git            | https://127.0.0.1/gitlab/db/test_project_7.git            | https://127.0.0.1/gitlab/db/test_project_7            | https://127.0.0.1/gitlab/db/test_project_7/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:25.15+00
  8 | Test Project 7            | test_project_7        | db / test_project_7                 | test_project_7        | db/test_project_7            | 2023-07-19 02:56:25.15+00  | master         | git@127.0.0.1:db/test_project_7.git            | https://127.0.0.1/gitlab/db/test_project_7.git            | https://127.0.0.1/gitlab/db/test_project_7            | https://127.0.0.1/gitlab/db/test_project_7/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:25.15+00
  9 | Test Project 8            | test_project_8        | db / test_project_8                 | test_project_8        | db/test_project_8            | 2023-07-19 02:56:29.952+00 | main           | git@127.0.0.1:db/test_project_8.git            | https://127.0.0.1/gitlab/db/test_project_8.git            | https://127.0.0.1/gitlab/db/test_project_8            | https://127.0.0.1/gitlab/db/test_project_8/-/blob/main/README.md              |            |           0 |          0 | 2023-07-19 02:56:29.952+00
  9 | Test Project 8            | test_project_8        | db / test_project_8                 | test_project_8        | db/test_project_8            | 2023-07-19 02:56:29.952+00 | main           | git@127.0.0.1:db/test_project_8.git            | https://127.0.0.1/gitlab/db/test_project_8.git            | https://127.0.0.1/gitlab/db/test_project_8            | https://127.0.0.1/gitlab/db/test_project_8/-/blob/main/README.md              |            |           0 |          0 | 2023-07-19 02:56:29.952+00
 10 | Test Project 9            | test_project_9        | db / test_project_9                 | test_project_9        | db/test_project_9            | 2023-07-19 02:56:34.507+00 | start_branch   | git@127.0.0.1:db/test_project_9.git            | https://127.0.0.1/gitlab/db/test_project_9.git            | https://127.0.0.1/gitlab/db/test_project_9            | https://127.0.0.1/gitlab/db/test_project_9/-/blob/start_branch/README.md      |            |           0 |          0 | 2023-07-19 02:56:34.507+00
 10 | Test Project 9            | test_project_9        | db / test_project_9                 | test_project_9        | db/test_project_9            | 2023-07-19 02:56:34.507+00 | start_branch   | git@127.0.0.1:db/test_project_9.git            | https://127.0.0.1/gitlab/db/test_project_9.git            | https://127.0.0.1/gitlab/db/test_project_9            | https://127.0.0.1/gitlab/db/test_project_9/-/blob/start_branch/README.md      |            |           0 |          0 | 2023-07-19 02:56:34.507+00
 11 | Test gitlab_fdw project 1 | test_project_gitlab_1 | Alan Nguyen / test_project_gitlab_1 | test_project_gitlab_1 | user_1/test_project_gitlab_1 | 2023-07-19 02:56:38.009+00 | master         | git@127.0.0.1:user_1/test_project_gitlab_1.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_1.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_1 | https://127.0.0.1/gitlab/user_1/test_project_gitlab_1/-/blob/master/README.md |            |           0 |          1 | 2023-07-19 02:56:38.009+00
 11 | Test gitlab_fdw project 1 | test_project_gitlab_1 | Alan Nguyen / test_project_gitlab_1 | test_project_gitlab_1 | user_1/test_project_gitlab_1 | 2023-07-19 02:56:38.009+00 | master         | git@127.0.0.1:user_1/test_project_gitlab_1.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_1.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_1 | https://127.0.0.1/gitlab/user_1/test_project_gitlab_1/-/blob/master/README.md |            |           0 |          1 | 2023-07-19 02:56:38.009+00
 12 | Test gitlab_fdw project 2 | test_project_gitlab_2 | Alan Nguyen / test_project_gitlab_2 | test_project_gitlab_2 | user_1/test_project_gitlab_2 | 2023-07-19 02:56:42.641+00 | master         | git@127.0.0.1:user_1/test_project_gitlab_2.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2 | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2/-/blob/master/README.md |            |           0 |          1 | 2023-07-19 02:56:42.641+00
 12 | Test gitlab_fdw project 2 | test_project_gitlab_2 | Alan Nguyen / test_project_gitlab_2 | test_project_gitlab_2 | user_1/test_project_gitlab_2 | 2023-07-19 02:56:42.641+00 | master         | git@127.0.0.1:user_1/test_project_gitlab_2.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2 | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2/-/blob/master/README.md |            |           0 |          1 | 2023-07-19 02:56:42.641+00
 13 | Test Project 1            | test_project_1        | Alan Nguyen / test_project_1        | test_project_1        | user_1/test_project_1        | 2023-07-19 03:03:16.011+00 | master         | git@127.0.0.1:user_1/test_project_1.git        | https://127.0.0.1/gitlab/user_1/test_project_1.git        | https://127.0.0.1/gitlab/user_1/test_project_1        | https://127.0.0.1/gitlab/user_1/test_project_1/-/blob/master/README.md        |            |           0 |          0 | 2023-07-19 03:03:16.011+00
 13 | Test Project 1            | test_project_1        | Alan Nguyen / test_project_1        | test_project_1        | user_1/test_project_1        | 2023-07-19 03:03:16.011+00 | master         | git@127.0.0.1:user_1/test_project_1.git        | https://127.0.0.1/gitlab/user_1/test_project_1.git        | https://127.0.0.1/gitlab/user_1/test_project_1        | https://127.0.0.1/gitlab/user_1/test_project_1/-/blob/master/README.md        |            |           0 |          0 | 2023-07-19 03:03:16.011+00
(24 rows)

--Testcase 18:
EXPLAIN VERBOSE SELECT * FROM projects WHERE default_branch != 'main' ORDER BY id, __spd_url;
                                                                                                                 QUERY PLAN                                                                                                                  
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort  (cost=874.14..891.12 rows=6792 width=424)
   Output: id, description, name, name_with_namespace, path, path_with_namespace, created_at, default_branch, ssh_url_to_repo, http_url_to_repo, web_url, readme_url, avatar_url, forks_count, star_count, last_activity_at, __spd_url
   Sort Key: projects.id, projects.__spd_url
   ->  Foreign Scan on public.projects  (cost=200.00..441.84 rows=6792 width=424)
         Output: id, description, name, name_with_namespace, path, path_with_namespace, created_at, default_branch, ssh_url_to_repo, http_url_to_repo, web_url, readme_url, avatar_url, forks_count, star_count, last_activity_at, __spd_url
         Filter: (projects.default_branch <> 'main'::text)
         Node: gitlab_svr1 / Status: Alive
           Sort push-down: no
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
         Node: gitlab_svr2 / Status: Alive
           Sort push-down: no
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(12 rows)

--Testcase 19:
SELECT * FROM projects WHERE default_branch != 'main' ORDER BY id, __spd_url;
 id |        description        |         name          |         name_with_namespace         |         path          |     path_with_namespace      |         created_at         | default_branch |                ssh_url_to_repo                 |                     http_url_to_repo                      |                        web_url                        |                                  readme_url                                   | avatar_url | forks_count | star_count |      last_activity_at      |   __spd_url   
----+---------------------------+-----------------------+-------------------------------------+-----------------------+------------------------------+----------------------------+----------------+------------------------------------------------+-----------------------------------------------------------+-------------------------------------------------------+-------------------------------------------------------------------------------+------------+-------------+------------+----------------------------+---------------
  2 | Test Project 1            | test_project_1        | db / test_project_1                 | test_project_1        | db/test_project_1            | 2023-07-19 02:55:54.527+00 | master         | git@127.0.0.1:db/test_project_1.git            | https://127.0.0.1/gitlab/db/test_project_1.git            | https://127.0.0.1/gitlab/db/test_project_1            | https://127.0.0.1/gitlab/db/test_project_1/-/blob/master/README.md            |            |           1 |          0 | 2023-07-19 02:55:54.527+00 | /gitlab_svr1/
  2 | Test Project 1            | test_project_1        | db / test_project_1                 | test_project_1        | db/test_project_1            | 2023-07-19 02:55:54.527+00 | master         | git@127.0.0.1:db/test_project_1.git            | https://127.0.0.1/gitlab/db/test_project_1.git            | https://127.0.0.1/gitlab/db/test_project_1            | https://127.0.0.1/gitlab/db/test_project_1/-/blob/master/README.md            |            |           1 |          0 | 2023-07-19 02:55:54.527+00 | /gitlab_svr2/
  3 | Test Project 2            | test_project_2        | db / test_project_2                 | test_project_2        | db/test_project_2            | 2023-07-19 02:56:04.34+00  | master         | git@127.0.0.1:db/test_project_2.git            | https://127.0.0.1/gitlab/db/test_project_2.git            | https://127.0.0.1/gitlab/db/test_project_2            | https://127.0.0.1/gitlab/db/test_project_2/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:04.34+00  | /gitlab_svr1/
  3 | Test Project 2            | test_project_2        | db / test_project_2                 | test_project_2        | db/test_project_2            | 2023-07-19 02:56:04.34+00  | master         | git@127.0.0.1:db/test_project_2.git            | https://127.0.0.1/gitlab/db/test_project_2.git            | https://127.0.0.1/gitlab/db/test_project_2            | https://127.0.0.1/gitlab/db/test_project_2/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:04.34+00  | /gitlab_svr2/
  4 | Test Project 3            | test_project_3        | db / test_project_3                 | test_project_3        | db/test_project_3            | 2023-07-19 02:56:07.775+00 | master         | git@127.0.0.1:db/test_project_3.git            | https://127.0.0.1/gitlab/db/test_project_3.git            | https://127.0.0.1/gitlab/db/test_project_3            | https://127.0.0.1/gitlab/db/test_project_3/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:07.775+00 | /gitlab_svr1/
  4 | Test Project 3            | test_project_3        | db / test_project_3                 | test_project_3        | db/test_project_3            | 2023-07-19 02:56:07.775+00 | master         | git@127.0.0.1:db/test_project_3.git            | https://127.0.0.1/gitlab/db/test_project_3.git            | https://127.0.0.1/gitlab/db/test_project_3            | https://127.0.0.1/gitlab/db/test_project_3/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:07.775+00 | /gitlab_svr2/
  5 | Test Project 4            | test_project_4        | db / test_project_4                 | test_project_4        | db/test_project_4            | 2023-07-19 02:56:11.626+00 | master         | git@127.0.0.1:db/test_project_4.git            | https://127.0.0.1/gitlab/db/test_project_4.git            | https://127.0.0.1/gitlab/db/test_project_4            | https://127.0.0.1/gitlab/db/test_project_4/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:11.626+00 | /gitlab_svr1/
  5 | Test Project 4            | test_project_4        | db / test_project_4                 | test_project_4        | db/test_project_4            | 2023-07-19 02:56:11.626+00 | master         | git@127.0.0.1:db/test_project_4.git            | https://127.0.0.1/gitlab/db/test_project_4.git            | https://127.0.0.1/gitlab/db/test_project_4            | https://127.0.0.1/gitlab/db/test_project_4/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:11.626+00 | /gitlab_svr2/
  6 | Test Project 5            | test_project_5        | db / test_project_5                 | test_project_5        | db/test_project_5            | 2023-07-19 02:56:19.285+00 | master         | git@127.0.0.1:db/test_project_5.git            | https://127.0.0.1/gitlab/db/test_project_5.git            | https://127.0.0.1/gitlab/db/test_project_5            | https://127.0.0.1/gitlab/db/test_project_5/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:19.285+00 | /gitlab_svr1/
  6 | Test Project 5            | test_project_5        | db / test_project_5                 | test_project_5        | db/test_project_5            | 2023-07-19 02:56:19.285+00 | master         | git@127.0.0.1:db/test_project_5.git            | https://127.0.0.1/gitlab/db/test_project_5.git            | https://127.0.0.1/gitlab/db/test_project_5            | https://127.0.0.1/gitlab/db/test_project_5/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:19.285+00 | /gitlab_svr2/
  7 | Test Project 6            | test_project_6        | db / test_project_6                 | test_project_6        | db/test_project_6            | 2023-07-19 02:56:22.376+00 | master         | git@127.0.0.1:db/test_project_6.git            | https://127.0.0.1/gitlab/db/test_project_6.git            | https://127.0.0.1/gitlab/db/test_project_6            | https://127.0.0.1/gitlab/db/test_project_6/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:22.376+00 | /gitlab_svr1/
  7 | Test Project 6            | test_project_6        | db / test_project_6                 | test_project_6        | db/test_project_6            | 2023-07-19 02:56:22.376+00 | master         | git@127.0.0.1:db/test_project_6.git            | https://127.0.0.1/gitlab/db/test_project_6.git            | https://127.0.0.1/gitlab/db/test_project_6            | https://127.0.0.1/gitlab/db/test_project_6/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:22.376+00 | /gitlab_svr2/
  8 | Test Project 7            | test_project_7        | db / test_project_7                 | test_project_7        | db/test_project_7            | 2023-07-19 02:56:25.15+00  | master         | git@127.0.0.1:db/test_project_7.git            | https://127.0.0.1/gitlab/db/test_project_7.git            | https://127.0.0.1/gitlab/db/test_project_7            | https://127.0.0.1/gitlab/db/test_project_7/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:25.15+00  | /gitlab_svr1/
  8 | Test Project 7            | test_project_7        | db / test_project_7                 | test_project_7        | db/test_project_7            | 2023-07-19 02:56:25.15+00  | master         | git@127.0.0.1:db/test_project_7.git            | https://127.0.0.1/gitlab/db/test_project_7.git            | https://127.0.0.1/gitlab/db/test_project_7            | https://127.0.0.1/gitlab/db/test_project_7/-/blob/master/README.md            |            |           0 |          0 | 2023-07-19 02:56:25.15+00  | /gitlab_svr2/
 10 | Test Project 9            | test_project_9        | db / test_project_9                 | test_project_9        | db/test_project_9            | 2023-07-19 02:56:34.507+00 | start_branch   | git@127.0.0.1:db/test_project_9.git            | https://127.0.0.1/gitlab/db/test_project_9.git            | https://127.0.0.1/gitlab/db/test_project_9            | https://127.0.0.1/gitlab/db/test_project_9/-/blob/start_branch/README.md      |            |           0 |          0 | 2023-07-19 02:56:34.507+00 | /gitlab_svr1/
 10 | Test Project 9            | test_project_9        | db / test_project_9                 | test_project_9        | db/test_project_9            | 2023-07-19 02:56:34.507+00 | start_branch   | git@127.0.0.1:db/test_project_9.git            | https://127.0.0.1/gitlab/db/test_project_9.git            | https://127.0.0.1/gitlab/db/test_project_9            | https://127.0.0.1/gitlab/db/test_project_9/-/blob/start_branch/README.md      |            |           0 |          0 | 2023-07-19 02:56:34.507+00 | /gitlab_svr2/
 11 | Test gitlab_fdw project 1 | test_project_gitlab_1 | Alan Nguyen / test_project_gitlab_1 | test_project_gitlab_1 | user_1/test_project_gitlab_1 | 2023-07-19 02:56:38.009+00 | master         | git@127.0.0.1:user_1/test_project_gitlab_1.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_1.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_1 | https://127.0.0.1/gitlab/user_1/test_project_gitlab_1/-/blob/master/README.md |            |           0 |          1 | 2023-07-19 02:56:38.009+00 | /gitlab_svr1/
 11 | Test gitlab_fdw project 1 | test_project_gitlab_1 | Alan Nguyen / test_project_gitlab_1 | test_project_gitlab_1 | user_1/test_project_gitlab_1 | 2023-07-19 02:56:38.009+00 | master         | git@127.0.0.1:user_1/test_project_gitlab_1.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_1.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_1 | https://127.0.0.1/gitlab/user_1/test_project_gitlab_1/-/blob/master/README.md |            |           0 |          1 | 2023-07-19 02:56:38.009+00 | /gitlab_svr2/
 12 | Test gitlab_fdw project 2 | test_project_gitlab_2 | Alan Nguyen / test_project_gitlab_2 | test_project_gitlab_2 | user_1/test_project_gitlab_2 | 2023-07-19 02:56:42.641+00 | master         | git@127.0.0.1:user_1/test_project_gitlab_2.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2 | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2/-/blob/master/README.md |            |           0 |          1 | 2023-07-19 02:56:42.641+00 | /gitlab_svr1/
 12 | Test gitlab_fdw project 2 | test_project_gitlab_2 | Alan Nguyen / test_project_gitlab_2 | test_project_gitlab_2 | user_1/test_project_gitlab_2 | 2023-07-19 02:56:42.641+00 | master         | git@127.0.0.1:user_1/test_project_gitlab_2.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2.git | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2 | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2/-/blob/master/README.md |            |           0 |          1 | 2023-07-19 02:56:42.641+00 | /gitlab_svr2/
 13 | Test Project 1            | test_project_1        | Alan Nguyen / test_project_1        | test_project_1        | user_1/test_project_1        | 2023-07-19 03:03:16.011+00 | master         | git@127.0.0.1:user_1/test_project_1.git        | https://127.0.0.1/gitlab/user_1/test_project_1.git        | https://127.0.0.1/gitlab/user_1/test_project_1        | https://127.0.0.1/gitlab/user_1/test_project_1/-/blob/master/README.md        |            |           0 |          0 | 2023-07-19 03:03:16.011+00 | /gitlab_svr1/
 13 | Test Project 1            | test_project_1        | Alan Nguyen / test_project_1        | test_project_1        | user_1/test_project_1        | 2023-07-19 03:03:16.011+00 | master         | git@127.0.0.1:user_1/test_project_1.git        | https://127.0.0.1/gitlab/user_1/test_project_1.git        | https://127.0.0.1/gitlab/user_1/test_project_1        | https://127.0.0.1/gitlab/user_1/test_project_1/-/blob/master/README.md        |            |           0 |          0 | 2023-07-19 03:03:16.011+00 | /gitlab_svr2/
(22 rows)

--Testcase 20:
EXPLAIN VERBOSE SELECT description, name, name_with_namespace, forks_count, star_count FROM projects WHERE description >= 'Test' AND name = 'test_project_gitlab_1' ORDER BY 1, 2, 3, 4, 5;
                                                  QUERY PLAN                                                  
--------------------------------------------------------------------------------------------------------------
 Sort  (cost=459.13..459.16 rows=12 width=112)
   Output: description, name, name_with_namespace, forks_count, star_count
   Sort Key: projects.description, projects.name_with_namespace, projects.forks_count, projects.star_count
   ->  Foreign Scan on public.projects  (cost=200.00..458.91 rows=12 width=112)
         Output: description, name, name_with_namespace, forks_count, star_count
         Filter: ((projects.description >= 'Test'::text) AND (projects.name = 'test_project_gitlab_1'::text))
         Node: gitlab_svr1 / Status: Alive
           Sort push-down: no
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
         Node: gitlab_svr2 / Status: Alive
           Sort push-down: no
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(12 rows)

--Testcase 21:
SELECT description, name, name_with_namespace, forks_count, star_count FROM projects WHERE description >= 'Test' AND name = 'test_project_gitlab_1' ORDER BY 1, 2, 3, 4, 5;
        description        |         name          |         name_with_namespace         | forks_count | star_count 
---------------------------+-----------------------+-------------------------------------+-------------+------------
 Test gitlab_fdw project 1 | test_project_gitlab_1 | Alan Nguyen / test_project_gitlab_1 |           0 |          1
 Test gitlab_fdw project 1 | test_project_gitlab_1 | Alan Nguyen / test_project_gitlab_1 |           0 |          1
(2 rows)

-- SELECT columns with LIMIT/OFFSET/ORDER BY
--Testcase 22:
EXPLAIN VERBOSE SELECT name_with_namespace, default_branch, path_with_namespace FROM projects ORDER BY 1, 2, 3 LIMIT 5;
                                              QUERY PLAN                                               
-------------------------------------------------------------------------------------------------------
 Limit  (cost=538.16..538.17 rows=5 width=96)
   Output: name_with_namespace, default_branch, path_with_namespace
   ->  Sort  (cost=538.16..555.22 rows=6826 width=96)
         Output: name_with_namespace, default_branch, path_with_namespace
         Sort Key: projects.name_with_namespace, projects.default_branch, projects.path_with_namespace
         ->  Foreign Scan on public.projects  (cost=200.00..424.78 rows=6826 width=96)
               Output: name_with_namespace, default_branch, path_with_namespace
               Node: gitlab_svr1 / Status: Alive
                 Limit push-down: no
                 Sort push-down: no
                 Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
               Node: gitlab_svr2 / Status: Alive
                 Limit push-down: no
                 Sort push-down: no
                 Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(15 rows)

--Testcase 23:
SELECT name_with_namespace, default_branch, path_with_namespace FROM projects ORDER BY 1, 2, 3 LIMIT 5;
         name_with_namespace         | default_branch |     path_with_namespace      
-------------------------------------+----------------+------------------------------
 Alan Nguyen / test_project_1        | master         | user_1/test_project_1
 Alan Nguyen / test_project_1        | master         | user_1/test_project_1
 Alan Nguyen / test_project_gitlab_1 | master         | user_1/test_project_gitlab_1
 Alan Nguyen / test_project_gitlab_1 | master         | user_1/test_project_gitlab_1
 Alan Nguyen / test_project_gitlab_2 | master         | user_1/test_project_gitlab_2
(5 rows)

--Testcase 24:
EXPLAIN VERBOSE SELECT id, description, name, http_url_to_repo FROM projects ORDER BY id LIMIT 3 OFFSET 2;
                                       QUERY PLAN                                       
----------------------------------------------------------------------------------------
 Limit  (cost=538.16..538.17 rows=3 width=104)
   Output: id, description, name, http_url_to_repo
   ->  Sort  (cost=538.16..555.22 rows=6826 width=104)
         Output: id, description, name, http_url_to_repo
         Sort Key: projects.id
         ->  Foreign Scan on public.projects  (cost=200.00..424.78 rows=6826 width=104)
               Output: id, description, name, http_url_to_repo
               Node: gitlab_svr1 / Status: Alive
                 Limit push-down: no
                 Sort push-down: no
                 Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
               Node: gitlab_svr2 / Status: Alive
                 Limit push-down: no
                 Sort push-down: no
                 Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(15 rows)

--Testcase 25:
SELECT id, description, name, http_url_to_repo FROM projects ORDER BY id LIMIT 3 OFFSET 2;
 id |  description   |      name      |                http_url_to_repo                
----+----------------+----------------+------------------------------------------------
  3 | Test Project 2 | test_project_2 | https://127.0.0.1/gitlab/db/test_project_2.git
  3 | Test Project 2 | test_project_2 | https://127.0.0.1/gitlab/db/test_project_2.git
  4 | Test Project 3 | test_project_3 | https://127.0.0.1/gitlab/db/test_project_3.git
(3 rows)

--Testcase 26:
EXPLAIN VERBOSE SELECT star_count, forks_count, web_url FROM projects WHERE star_count > 0 AND forks_count >= 0 ORDER BY 1, 2, 3 LIMIT 10 OFFSET 1;
                                      QUERY PLAN                                      
--------------------------------------------------------------------------------------
 Limit  (cost=475.73..475.76 rows=10 width=48)
   Output: star_count, forks_count, web_url
   ->  Sort  (cost=475.73..477.63 rows=758 width=48)
         Output: star_count, forks_count, web_url
         Sort Key: projects.star_count, projects.forks_count, projects.web_url
         ->  Foreign Scan on public.projects  (cost=200.00..458.83 rows=758 width=48)
               Output: star_count, forks_count, web_url
               Filter: ((projects.star_count > 0) AND (projects.forks_count >= 0))
               Node: gitlab_svr1 / Status: Alive
                 Limit push-down: no
                 Sort push-down: no
                 Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
               Node: gitlab_svr2 / Status: Alive
                 Limit push-down: no
                 Sort push-down: no
                 Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(16 rows)

--Testcase 27:
SELECT star_count, forks_count, web_url FROM projects WHERE star_count > 0 AND forks_count >= 0 ORDER BY 1, 2, 3 LIMIT 10 OFFSET 1;
 star_count | forks_count |                        web_url                        
------------+-------------+-------------------------------------------------------
          1 |           0 | https://127.0.0.1/gitlab/user_1/test_project_gitlab_1
          1 |           0 | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2
          1 |           0 | https://127.0.0.1/gitlab/user_1/test_project_gitlab_2
(3 rows)

--Testcase 28:
EXPLAIN VERBOSE SELECT readme_url, name, "path" FROM projects WHERE star_count = 0 OR forks_count = 0 ORDER BY 1, 2, 3 LIMIT 10 OFFSET 3;
                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Limit  (cost=460.36..460.38 rows=10 width=96)
   Output: readme_url, name, path
   ->  Sort  (cost=460.35..460.52 rows=68 width=96)
         Output: readme_url, name, path
         Sort Key: projects.readme_url, projects.name, projects.path
         ->  Foreign Scan on public.projects  (cost=200.00..458.75 rows=68 width=96)
               Output: readme_url, name, path
               Filter: ((projects.star_count = 0) OR (projects.forks_count = 0))
               Node: gitlab_svr1 / Status: Alive
                 Limit push-down: no
                 Sort push-down: no
                 Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
               Node: gitlab_svr2 / Status: Alive
                 Limit push-down: no
                 Sort push-down: no
                 Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(16 rows)

--Testcase 29:
SELECT readme_url, name, "path" FROM projects WHERE star_count = 0 OR forks_count = 0 ORDER BY 1, 2, 3 LIMIT 10 OFFSET 3;
                             readme_url                             |      name      |      path      
--------------------------------------------------------------------+----------------+----------------
 https://127.0.0.1/gitlab/db/test_project_2/-/blob/master/README.md | test_project_2 | test_project_2
 https://127.0.0.1/gitlab/db/test_project_3/-/blob/master/README.md | test_project_3 | test_project_3
 https://127.0.0.1/gitlab/db/test_project_3/-/blob/master/README.md | test_project_3 | test_project_3
 https://127.0.0.1/gitlab/db/test_project_4/-/blob/master/README.md | test_project_4 | test_project_4
 https://127.0.0.1/gitlab/db/test_project_4/-/blob/master/README.md | test_project_4 | test_project_4
 https://127.0.0.1/gitlab/db/test_project_5/-/blob/master/README.md | test_project_5 | test_project_5
 https://127.0.0.1/gitlab/db/test_project_5/-/blob/master/README.md | test_project_5 | test_project_5
 https://127.0.0.1/gitlab/db/test_project_6/-/blob/master/README.md | test_project_6 | test_project_6
 https://127.0.0.1/gitlab/db/test_project_6/-/blob/master/README.md | test_project_6 | test_project_6
 https://127.0.0.1/gitlab/db/test_project_7/-/blob/master/README.md | test_project_7 | test_project_7
(10 rows)

-- select Aggregation function, group by, having and join
--Testcase 30:
EXPLAIN VERBOSE SELECT (SELECT max((SELECT i.id FROM projects i WHERE i.id = o.id LIMIT 1))) FROM projects o;
                                       QUERY PLAN                                       
----------------------------------------------------------------------------------------
 Aggregate  (cost=1414091.39..1414091.41 rows=1 width=8)
   Output: (SubPlan 2)
   ->  Foreign Scan on public.projects o  (cost=200.00..424.78 rows=6826 width=8)
         Output: o.id
         Node: gitlab_svr1 / Status: Alive
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
         Node: gitlab_svr2 / Status: Alive
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
   SubPlan 2
     ->  Result  (cost=0.00..0.01 rows=1 width=8)
           Output: max((SubPlan 1))
   SubPlan 1
     ->  Limit  (cost=200.00..207.10 rows=1 width=8)
           Output: i.id
           ->  Foreign Scan on public.projects i  (cost=200.00..441.32 rows=34 width=8)
                 Output: i.id
                 Filter: (i.id = o.id)
                 Node: gitlab_svr1 / Status: Alive
                   Limit push-down: no
                   Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
                 Node: gitlab_svr2 / Status: Alive
                   Limit push-down: no
                   Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(23 rows)

--Testcase 31:
SELECT (SELECT max((SELECT i.id FROM projects i WHERE i.id = o.id  LIMIT 1))) FROM projects o;
 max 
-----
  13
(1 row)

--Testcase 32:
EXPLAIN VERBOSE SELECT count(*) FROM projects;
                                   QUERY PLAN                                   
--------------------------------------------------------------------------------
 Aggregate  (cost=441.84..441.85 rows=1 width=8)
   Output: count(*)
   ->  Foreign Scan on public.projects  (cost=200.00..424.78 rows=6826 width=0)
         Node: gitlab_svr1 / Status: Alive
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
         Node: gitlab_svr2 / Status: Alive
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(7 rows)

--Testcase 33:
SELECT count(*) FROM projects;
 count 
-------
    24
(1 row)

--Testcase 34:
EXPLAIN VERBOSE SELECT avg(forks_count), sum(star_count) FROM projects;
                                   QUERY PLAN                                    
---------------------------------------------------------------------------------
 Aggregate  (cost=458.91..458.92 rows=1 width=64)
   Output: avg(forks_count), sum(star_count)
   ->  Foreign Scan on public.projects  (cost=200.00..424.78 rows=6826 width=16)
         Output: forks_count, star_count
         Node: gitlab_svr1 / Status: Alive
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
         Node: gitlab_svr2 / Status: Alive
           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(8 rows)

--Testcase 35:
SELECT avg(forks_count), sum(star_count) FROM projects;
          avg           | sum 
------------------------+-----
 0.08333333333333333333 |   4
(1 row)

--Testcase 36:
EXPLAIN VERBOSE SELECT name, sum(forks_count) + sum(star_count) FROM projects GROUP BY name HAVING name >= 'test' ORDER BY name;
                                      QUERY PLAN                                       
---------------------------------------------------------------------------------------
 Sort  (cost=470.06..470.56 rows=200 width=64)
   Output: name, ((sum(forks_count) + sum(star_count)))
   Sort Key: projects.name
   ->  HashAggregate  (cost=458.91..462.41 rows=200 width=64)
         Output: name, (sum(forks_count) + sum(star_count))
         Group Key: projects.name
         ->  Foreign Scan on public.projects  (cost=200.00..441.84 rows=2276 width=48)
               Output: name, forks_count, star_count
               Filter: (projects.name >= 'test'::text)
               Node: gitlab_svr1 / Status: Alive
                 Sort push-down: no
                 Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
               Node: gitlab_svr2 / Status: Alive
                 Sort push-down: no
                 Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(15 rows)

--Testcase 37:
SELECT name, sum(forks_count) + sum(star_count) FROM projects GROUP BY name HAVING name >= 'test' ORDER BY name;
         name          | ?column? 
-----------------------+----------
 test_project_1        |        2
 test_project_2        |        0
 test_project_3        |        0
 test_project_4        |        0
 test_project_5        |        0
 test_project_6        |        0
 test_project_7        |        0
 test_project_8        |        0
 test_project_9        |        0
 test_project_gitlab_1 |        2
 test_project_gitlab_2 |        2
(11 rows)

-- select data with combine conditions
--Testcase 38:
EXPLAIN VERBOSE SELECT count(*)
FROM
  (SELECT t3.id AS x1
   FROM projects t1
   LEFT JOIN projects t2 ON t1.id = t2.id
   JOIN projects t3 ON t1.name = t3.name) ss,
  projects t4,
  projects t5
WHERE t4.name_with_namespace = t5.name_with_namespace AND ss.x1 = t4.id;
                                                             QUERY PLAN                                                             
------------------------------------------------------------------------------------------------------------------------------------
 Aggregate  (cost=163416732.52..163416732.53 rows=1 width=8)
   Output: count(*)
   ->  Merge Join  (cost=1308699.31..140261415.84 rows=9262126669 width=0)
         Merge Cond: (t4.id = t3.id)
         ->  Sort  (cost=29205.29..29787.72 rows=232971 width=8)
               Output: t4.id
               Sort Key: t4.id
               ->  Merge Join  (cost=1718.98..5247.67 rows=232971 width=8)
                     Output: t4.id
                     Merge Cond: (t4.name_with_namespace = t5.name_with_namespace)
                     ->  Sort  (cost=859.49..876.55 rows=6826 width=40)
                           Output: t4.name_with_namespace, t4.id
                           Sort Key: t4.name_with_namespace
                           ->  Foreign Scan on public.projects t4  (cost=200.00..424.78 rows=6826 width=40)
                                 Output: t4.name_with_namespace, t4.id
                                 Node: gitlab_svr1 / Status: Alive
                                   Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
                                 Node: gitlab_svr2 / Status: Alive
                                   Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
                     ->  Sort  (cost=859.49..876.55 rows=6826 width=32)
                           Output: t5.name_with_namespace
                           Sort Key: t5.name_with_namespace
                           ->  Foreign Scan on public.projects t5  (cost=200.00..424.78 rows=6826 width=32)
                                 Output: t5.name_with_namespace
                                 Node: gitlab_svr1 / Status: Alive
                                   Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
                                 Node: gitlab_svr2 / Status: Alive
                                   Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
         ->  Materialize  (cost=1279494.02..1319250.52 rows=7951300 width=8)
               Output: t3.id
               ->  Sort  (cost=1279494.02..1299372.27 rows=7951300 width=8)
                     Output: t3.id
                     Sort Key: t3.id
                     ->  Merge Right Join  (cost=30859.28..150745.34 rows=7951300 width=8)
                           Output: t3.id
                           Merge Cond: (t2.id = t1.id)
                           ->  Sort  (cost=859.49..876.55 rows=6826 width=8)
                                 Output: t2.id
                                 Sort Key: t2.id
                                 ->  Foreign Scan on public.projects t2  (cost=200.00..424.78 rows=6826 width=8)
                                       Output: t2.id
                                       Node: gitlab_svr1 / Status: Alive
                                         Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
                                       Node: gitlab_svr2 / Status: Alive
                                         Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
                           ->  Materialize  (cost=29999.79..31164.65 rows=232971 width=16)
                                 Output: t1.id, t3.id
                                 ->  Sort  (cost=29999.79..30582.22 rows=232971 width=16)
                                       Output: t1.id, t3.id
                                       Sort Key: t1.id
                                       ->  Merge Join  (cost=1718.98..5247.67 rows=232971 width=16)
                                             Output: t1.id, t3.id
                                             Merge Cond: (t1.name = t3.name)
                                             ->  Sort  (cost=859.49..876.55 rows=6826 width=40)
                                                   Output: t1.name, t1.id
                                                   Sort Key: t1.name
                                                   ->  Foreign Scan on public.projects t1  (cost=200.00..424.78 rows=6826 width=40)
                                                         Output: t1.name, t1.id
                                                         Node: gitlab_svr1 / Status: Alive
                                                           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
                                                         Node: gitlab_svr2 / Status: Alive
                                                           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
                                             ->  Sort  (cost=859.49..876.55 rows=6826 width=40)
                                                   Output: t3.name, t3.id
                                                   Sort Key: t3.name
                                                   ->  Foreign Scan on public.projects t3  (cost=200.00..424.78 rows=6826 width=40)
                                                         Output: t3.name, t3.id
                                                         Node: gitlab_svr1 / Status: Alive
                                                           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
                                                         Node: gitlab_svr2 / Status: Alive
                                                           Remote URI: GET https://127.0.0.1:443/gitlab/api/v4/projects
(71 rows)

--Testcase 39:
SELECT count(*)
FROM
  (SELECT t3.id AS x1
   FROM projects t1
   LEFT JOIN projects t2 ON t1.id = t2.id
   JOIN projects t3 ON t1.name = t3.name) ss,
  projects t4,
  projects t5
WHERE t4.name_with_namespace = t5.name_with_namespace AND ss.x1 = t4.id;
 count 
-------
   448
(1 row)

--Testcase 40:
DROP EXTENSION gitlab_fdw CASCADE;
NOTICE:  drop cascades to 6 other objects
DETAIL:  drop cascades to server gitlab_svr1
drop cascades to user mapping for public on server gitlab_svr1
drop cascades to foreign table projects__gitlab_svr1__0
drop cascades to server gitlab_svr2
drop cascades to user mapping for public on server gitlab_svr2
drop cascades to foreign table projects__gitlab_svr2__0
--Testcase 41:
DROP EXTENSION pgspider_core_fdw CASCADE;
NOTICE:  drop cascades to 3 other objects
DETAIL:  drop cascades to server pgspider_core_srv
drop cascades to user mapping for public on server pgspider_core_srv
drop cascades to foreign table projects
