CREATE EXTENSION pgspider_core_fdw;
CREATE SERVER pgspider_svr FOREIGN DATA WRAPPER pgspider_core_fdw OPTIONS (host '127.0.0.1',port '50849');
CREATE USER mapping for public server pgspider_svr OPTIONS(user 'postgres',password 'postgres');
CREATE FOREIGN TABLE test1 (i int,__spd_url text) SERVER pgspider_svr;
CREATE EXTENSION postgres_fdw;
CREATE EXTENSION file_fdw;
CREATE EXTENSION sqlite_fdw;
CREATE EXTENSION tinybrace_fdw;
CREATE EXTENSION mysql_fdw;
CREATE SERVER file_svr FOREIGN DATA WRAPPER file_fdw;
CREATE SERVER filesvr2 FOREIGN DATA WRAPPER file_fdw;
CREATE FOREIGN TABLE test1__file_svr__0 (i int) SERVER file_svr options(filename '/tmp/pgtest.csv');
SELECT * FROM test1;
 i | __spd_url  
---+------------
 1 | /file_svr/
 2 | /file_svr/
 3 | /file_svr/
 4 | /file_svr/
(4 rows)

CREATE FOREIGN TABLE test1__filesvr2__0 (i int) SERVER file_svr options(filename '/tmp/pgtest.csv');
SELECT * FROM test1 order by i,__spd_url;
 i | __spd_url  
---+------------
 1 | /file_svr/
 1 | /file_svr/
 2 | /file_svr/
 2 | /file_svr/
 3 | /file_svr/
 3 | /file_svr/
 4 | /file_svr/
 4 | /file_svr/
(8 rows)

SELECT * FROM test1 UNDER '/file_svr/' ORDER BY i,__spd_url;
 i | __spd_url  
---+------------
 1 | /file_svr/
 1 | /file_svr/
 2 | /file_svr/
 2 | /file_svr/
 3 | /file_svr/
 3 | /file_svr/
 4 | /file_svr/
 4 | /file_svr/
(8 rows)

SELECT * FROM test1 under '/file_svr/' where i = 1;
 i | __spd_url  
---+------------
 1 | /file_svr/
 1 | /file_svr/
(2 rows)

CREATE SERVER tiny_svr FOREIGN DATA WRAPPER tinybrace_fdw OPTIONS (host '127.0.0.1',port '5100', dbname 'test.db');
CREATE USER mapping for public server tiny_svr OPTIONS(username 'user',password 'testuser');
CREATE FOREIGN TABLE test1__tiny_svr__0 (i int) SERVER tiny_svr OPTIONS(table_name 'test1');
SELECT * FROM test1__tiny_svr__0 ORDER BY i;
 i 
---
 1
(1 row)

SELECT * FROM test1 ORDER BY i,__spd_url;
 i | __spd_url  
---+------------
 1 | /file_svr/
 1 | /file_svr/
 1 | /tiny_svr/
 2 | /file_svr/
 2 | /file_svr/
 3 | /file_svr/
 3 | /file_svr/
 4 | /file_svr/
 4 | /file_svr/
(9 rows)

SELECT * FROM test1 UNDER '/tiny_svr/';
 i | __spd_url  
---+------------
 1 | /tiny_svr/
(1 row)

SELECT * FROM test1 under '/tiny_svr/' where i = 1;
 i | __spd_url  
---+------------
 1 | /tiny_svr/
(1 row)

CREATE SERVER post_svr FOREIGN DATA WRAPPER postgres_fdw OPTIONS (host '127.0.0.1',port '15432');
CREATE USER mapping for public server post_svr OPTIONS(user 'postgres',password 'postgres');
CREATE FOREIGN TABLE test1__post_svr__0 (i int) SERVER post_svr OPTIONS(table_name 'test1');
SELECT * FROM test1__post_svr__0 ORDER BY i;
  i   
------
 1111
(1 row)

SELECT * FROM test1 ORDER BY i,__spd_url;
  i   | __spd_url  
------+------------
    1 | /file_svr/
    1 | /file_svr/
    1 | /tiny_svr/
    2 | /file_svr/
    2 | /file_svr/
    3 | /file_svr/
    3 | /file_svr/
    4 | /file_svr/
    4 | /file_svr/
 1111 | /post_svr/
(10 rows)

SELECT * FROM test1 UNDER '/post_svr/' ORDER BY i,__spd_url; 
  i   | __spd_url  
------+------------
 1111 | /post_svr/
(1 row)

SELECT * FROM test1 under '/post_svr/' where i = 1 ORDER BY i,__spd_url;
 i | __spd_url 
---+-----------
(0 rows)

CREATE SERVER sqlite_svr FOREIGN DATA WRAPPER sqlite_fdw OPTIONS (database '/tmp/pgtest.db');
CREATE FOREIGN TABLE test1__sqlite_svr__0 (i int) SERVER sqlite_svr OPTIONS(table 'test1');
SELECT * FROM test1 ORDER BY i,__spd_url;
   i   |  __spd_url   
-------+--------------
     1 | /file_svr/
     1 | /file_svr/
     1 | /sqlite_svr/
     1 | /tiny_svr/
     2 | /file_svr/
     2 | /file_svr/
     3 | /file_svr/
     3 | /file_svr/
     4 | /file_svr/
     4 | /file_svr/
  1111 | /post_svr/
 22222 | /sqlite_svr/
(12 rows)

SELECT * FROM test1 UNDER '/sqlite_svr/' ORDER BY i,__spd_url;
   i   |  __spd_url   
-------+--------------
     1 | /sqlite_svr/
 22222 | /sqlite_svr/
(2 rows)

SELECT * FROM test1 under '/sqlite_svr/' where i = 4 ORDER BY i,__spd_url;
 i | __spd_url 
---+-----------
(0 rows)

CREATE SERVER mysql_svr FOREIGN DATA WRAPPER mysql_fdw OPTIONS (host '127.0.0.1',port '3306');
CREATE USER mapping for public server mysql_svr OPTIONS(username 'root',password 'mysql');
CREATE FOREIGN TABLE test1__mysql_svr__0 (i int) SERVER mysql_svr OPTIONS(dbname 'test',table_name 'test1');
SELECT * FROM test1 ORDER BY i,__spd_url;
   i   |  __spd_url   
-------+--------------
     1 | /file_svr/
     1 | /file_svr/
     1 | /sqlite_svr/
     1 | /tiny_svr/
     2 | /file_svr/
     2 | /file_svr/
     3 | /file_svr/
     3 | /file_svr/
     4 | /file_svr/
     4 | /file_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
  1111 | /post_svr/
 22222 | /sqlite_svr/
(16 rows)

SELECT * FROM test1 UNDER '/mysql_svr/' ORDER BY i,__spd_url;
  i  |  __spd_url  
-----+-------------
 777 | /mysql_svr/
 777 | /mysql_svr/
 777 | /mysql_svr/
 777 | /mysql_svr/
(4 rows)

SELECT * FROM test1 where i = 1 ORDER BY i,__spd_url;
 i |  __spd_url   
---+--------------
 1 | /file_svr/
 1 | /file_svr/
 1 | /sqlite_svr/
 1 | /tiny_svr/
(4 rows)

SELECT * FROM test1 under '/mysql_svr/' where i = 5 ORDER BY i,__spd_url;
 i | __spd_url 
---+-----------
(0 rows)

SELECT * FROM test1 ORDER BY i,__spd_url;
   i   |  __spd_url   
-------+--------------
     1 | /file_svr/
     1 | /file_svr/
     1 | /sqlite_svr/
     1 | /tiny_svr/
     2 | /file_svr/
     2 | /file_svr/
     3 | /file_svr/
     3 | /file_svr/
     4 | /file_svr/
     4 | /file_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
  1111 | /post_svr/
 22222 | /sqlite_svr/
(16 rows)

SELECT * FROM test1 UNDER '/test2/' ORDER BY i,__spd_url;
 i | __spd_url 
---+-----------
(0 rows)

SELECT * FROM test1 order by i,__spd_url;
   i   |  __spd_url   
-------+--------------
     1 | /file_svr/
     1 | /file_svr/
     1 | /sqlite_svr/
     1 | /tiny_svr/
     2 | /file_svr/
     2 | /file_svr/
     3 | /file_svr/
     3 | /file_svr/
     4 | /file_svr/
     4 | /file_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
  1111 | /post_svr/
 22222 | /sqlite_svr/
(16 rows)

SELECT * FROM test1 UNDER '/file_svr/' ORDER BY i,__spd_url;
 i | __spd_url  
---+------------
 1 | /file_svr/
 1 | /file_svr/
 2 | /file_svr/
 2 | /file_svr/
 3 | /file_svr/
 3 | /file_svr/
 4 | /file_svr/
 4 | /file_svr/
(8 rows)

SELECT * FROM test1 under '/file_svr/' where i = 1 ORDER BY i,__spd_url;
 i | __spd_url  
---+------------
 1 | /file_svr/
 1 | /file_svr/
(2 rows)

SELECT * FROM test1__tiny_svr__0 order by i;
 i 
---
 1
(1 row)

SELECT * FROM test1 ORDER BY i,__spd_url;
   i   |  __spd_url   
-------+--------------
     1 | /file_svr/
     1 | /file_svr/
     1 | /sqlite_svr/
     1 | /tiny_svr/
     2 | /file_svr/
     2 | /file_svr/
     3 | /file_svr/
     3 | /file_svr/
     4 | /file_svr/
     4 | /file_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
  1111 | /post_svr/
 22222 | /sqlite_svr/
(16 rows)

SELECT * FROM test1 UNDER '/tiny_svr/';
 i | __spd_url  
---+------------
 1 | /tiny_svr/
(1 row)

SELECT * FROM test1 under '/tiny_svr/' where i = 1;
 i | __spd_url  
---+------------
 1 | /tiny_svr/
(1 row)

SELECT * FROM test1__post_svr__0 order by i;
  i   
------
 1111
(1 row)

SELECT * FROM test1 ORDER BY i,__spd_url;
   i   |  __spd_url   
-------+--------------
     1 | /file_svr/
     1 | /file_svr/
     1 | /sqlite_svr/
     1 | /tiny_svr/
     2 | /file_svr/
     2 | /file_svr/
     3 | /file_svr/
     3 | /file_svr/
     4 | /file_svr/
     4 | /file_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
  1111 | /post_svr/
 22222 | /sqlite_svr/
(16 rows)

SELECT * FROM test1 UNDER '/post_svr/' ORDER BY i,__spd_url;
  i   | __spd_url  
------+------------
 1111 | /post_svr/
(1 row)

SELECT * FROM test1 under '/post_svr/' where i = 1 ORDER BY i,__spd_url;
 i | __spd_url 
---+-----------
(0 rows)

SELECT * FROM test1 ORDER BY i,__spd_url;
   i   |  __spd_url   
-------+--------------
     1 | /file_svr/
     1 | /file_svr/
     1 | /sqlite_svr/
     1 | /tiny_svr/
     2 | /file_svr/
     2 | /file_svr/
     3 | /file_svr/
     3 | /file_svr/
     4 | /file_svr/
     4 | /file_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
  1111 | /post_svr/
 22222 | /sqlite_svr/
(16 rows)

SELECT * FROM test1 UNDER '/sqlite_svr/' ORDER BY i,__spd_url;
   i   |  __spd_url   
-------+--------------
     1 | /sqlite_svr/
 22222 | /sqlite_svr/
(2 rows)

SELECT * FROM test1 under '/sqlite_svr/' where i = 4 ORDER BY i,__spd_url;
 i | __spd_url 
---+-----------
(0 rows)

SELECT * FROM test1 ORDER BY i,__spd_url;
   i   |  __spd_url   
-------+--------------
     1 | /file_svr/
     1 | /file_svr/
     1 | /sqlite_svr/
     1 | /tiny_svr/
     2 | /file_svr/
     2 | /file_svr/
     3 | /file_svr/
     3 | /file_svr/
     4 | /file_svr/
     4 | /file_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
   777 | /mysql_svr/
  1111 | /post_svr/
 22222 | /sqlite_svr/
(16 rows)

SELECT * FROM test1 UNDER '/mysql_svr/' ORDER BY i,__spd_url;
  i  |  __spd_url  
-----+-------------
 777 | /mysql_svr/
 777 | /mysql_svr/
 777 | /mysql_svr/
 777 | /mysql_svr/
(4 rows)

SELECT * FROM test1 where i = 1 ORDER BY i,__spd_url;
 i |  __spd_url   
---+--------------
 1 | /file_svr/
 1 | /file_svr/
 1 | /sqlite_svr/
 1 | /tiny_svr/
(4 rows)

SELECT * FROM test1 under '/mysql_svr/' where i = 5 ORDER BY i,__spd_url;
 i | __spd_url 
---+-----------
(0 rows)

CREATE FOREIGN TABLE t1 (i int, t text,__spd_url text) SERVER pgspider_svr;
CREATE FOREIGN TABLE t1__post_svr__0 (i int, t text) SERVER post_svr OPTIONS(table_name 't1');
SELECT sum(i),t FROM t1 group by t;
 sum | t 
-----+---
   1 | a
   5 | b
   4 | c
(3 rows)

SELECT sum(i),t,count(i) FROM t1 group by t;
 sum | t | count 
-----+---+-------
   1 | a |     1
   5 | b |     2
   4 | c |     1
(3 rows)

CREATE FOREIGN TABLE t2 (i int, t text, a text,__spd_url text) SERVER pgspider_svr;
CREATE FOREIGN TABLE t2__post_svr__0 (i int, t text,a text) SERVER post_svr OPTIONS(table_name 't2');
SELECT i,t,a FROM t2 ORDER BY i,__spd_url;
 i | t | a 
---+---+---
 1 | a | 
 2 |   | a
   | a | a
   |   | 
(4 rows)

CREATE FOREIGN TABLE t2__post_svr__1 (i int, t text,a text) SERVER post_svr OPTIONS(table_name 't2');
CREATE FOREIGN TABLE t2__post_svr__2 (i int, t text,a text) SERVER post_svr OPTIONS(table_name 't2');
CREATE FOREIGN TABLE t2__post_svr__3 (i int, t text,a text) SERVER post_svr OPTIONS(table_name 't2');
SELECT i,t,a FROM t2 ORDER BY i,t,a,__spd_url;
 i | t | a 
---+---+---
 1 | a | 
 1 | a | 
 1 | a | 
 1 | a | 
 2 |   | a
 2 |   | a
 2 |   | a
 2 |   | a
   | a | a
   | a | a
   | a | a
   | a | a
   |   | 
   |   | 
   |   | 
   |   | 
(16 rows)

DROP USER MAPPING FOR public SERVER pgspider_svr;
DROP FOREIGN TABLE test1;
DROP FOREIGN TABLE t1;
DROP FOREIGN TABLE t2;
DROP SERVER pgspider_svr;
DROP EXTENSION pgspider_core_fdw;
